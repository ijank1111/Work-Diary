CREATE TABLE Users (
  UserID INT AUTO_INCREMENT PRIMARY KEY,
  Name VARCHAR(255) NOT NULL,
  Email VARCHAR(255) UNIQUE NOT NULL,
  PasswordHash VARCHAR(255) NOT NULL,
  Role VARCHAR(50) NOT NULL,
  CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE Listings (
  ListingID INT AUTO_INCREMENT PRIMARY KEY,
  UserID INT NOT NULL,
  Title VARCHAR(255) NOT NULL,
  Description TEXT,
  Category VARCHAR(100),
  Status VARCHAR(50),
  CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE
);

CREATE TABLE Promotions (
  PromotionID INT AUTO_INCREMENT PRIMARY KEY,
  ListingID INT NOT NULL,
  UserID INT NOT NULL,
  StartDate DATE NOT NULL,
  EndDate DATE NOT NULL,
  Status VARCHAR(50),
  FOREIGN KEY (ListingID) REFERENCES Listings(ListingID) ON DELETE CASCADE,
  FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE
);

CREATE TABLE Visits (
  VisitID INT AUTO_INCREMENT PRIMARY KEY,
  ListingID INT NOT NULL,
  UserID INT NULL,
  Device VARCHAR(100),
  Browser VARCHAR(100),
  Country VARCHAR(100),
  Referrer VARCHAR(255),
  Timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (ListingID) REFERENCES Listings(ListingID) ON DELETE CASCADE,
  FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE SET NULL
);

CREATE TABLE Analytics (
  AnalyticsID INT AUTO_INCREMENT PRIMARY KEY,
  ListingID INT NOT NULL,
  Views INT DEFAULT 0,
  UniqueViews INT DEFAULT 0,
  Clicks INT DEFAULT 0,
  Timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (ListingID) REFERENCES Listings(ListingID) ON DELETE CASCADE
);

CREATE TABLE Interactions (
  InteractionID INT AUTO_INCREMENT PRIMARY KEY,
  UserID INT NOT NULL,
  ListingID INT NOT NULL,
  ActionType VARCHAR(100) NOT NULL,
  Timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE,
  FOREIGN KEY (ListingID) REFERENCES Listings(ListingID) ON DELETE CASCADE
);

CREATE TABLE Businesses (
  BusinessID INT AUTO_INCREMENT PRIMARY KEY,
  UserID INT NOT NULL,
  Name VARCHAR(255) NOT NULL,
  Type VARCHAR(100),
  Address TEXT,
  ContactEmail VARCHAR(255),
  PhoneNumber VARCHAR(50),
  CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE
);

CREATE TABLE BusinessFeatures (
  FeatureID INT AUTO_INCREMENT PRIMARY KEY,
  BusinessID INT NOT NULL,
  Category VARCHAR(100),
  FeatureName VARCHAR(255),
  FOREIGN KEY (BusinessID) REFERENCES Businesses(BusinessID) ON DELETE CASCADE
);

CREATE TABLE BusinessWebApps (
  WebAppID INT AUTO_INCREMENT PRIMARY KEY,
  BusinessID INT NOT NULL,
  Name VARCHAR(255),
  FOREIGN KEY (BusinessID) REFERENCES Businesses(BusinessID) ON DELETE CASCADE
);

CREATE TABLE BusinessPhotos (
  PhotoID INT AUTO_INCREMENT PRIMARY KEY,
  BusinessID INT NOT NULL,
  PhotoURL VARCHAR(255) NOT NULL,
  UploadedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (BusinessID) REFERENCES Businesses(BusinessID) ON DELETE CASCADE
);

CREATE TABLE BusinessNotes (
  NoteID INT AUTO_INCREMENT PRIMARY KEY,
  BusinessID INT NOT NULL,
  Notes TEXT,
  CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (BusinessID) REFERENCES Businesses(BusinessID) ON DELETE CASCADE
);

CREATE TABLE Addresses (
  AddressID INT AUTO_INCREMENT PRIMARY KEY,
  UserID INT NOT NULL,
  StreetAddress VARCHAR(255),
  Apartment VARCHAR(100),
  City VARCHAR(100),
  County VARCHAR(100),
  Postcode VARCHAR(50),
  Phone VARCHAR(50),
  CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE
);

CREATE TABLE Orders (
  OrderID INT AUTO_INCREMENT PRIMARY KEY,
  UserID INT NOT NULL,
  AddressID INT NOT NULL,
  Status VARCHAR(50),
  TotalAmount DECIMAL(10,2) NOT NULL,
  CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE,
  FOREIGN KEY (AddressID) REFERENCES Addresses(AddressID) ON DELETE CASCADE
);

CREATE TABLE Payments (
  PaymentID INT AUTO_INCREMENT PRIMARY KEY,
  OrderID INT NOT NULL,
  UserID INT NOT NULL,
  PaymentMethod VARCHAR(50) NOT NULL,
  CardNumber VARCHAR(255) NOT NULL,
  ExpiryDate VARCHAR(10) NOT NULL,
  CVC VARCHAR(10) NOT NULL,
  Status VARCHAR(50),
  CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (OrderID) REFERENCES Orders(OrderID) ON DELETE CASCADE,
  FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE
);
